{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <script src="{% static 'js/script.js' %}"></script>
  </head>
  <body>
    <header>
      <a href="{% url 'posts:home' %}" class="header-link">Главная</a>
      <img src="{% static 'images/logo.svg' %}" alt="" />

      <span id="auth-links">
        {% if user.is_authenticated %}
          <a href="{% url 'users:profile' %}?user={{ user.id }}" class="header-link">Профиль</a>
          <a href="{% url 'users:logout' %}" class="header-link">Выйти</a>
        {% else %}
          <a href="{% url 'users:login' %}" class="header-link">Войти</a>
        {% endif %}
      </span>
    </header>

    {% block content %}

    {% endblock %}

    <footer>
      <a href="home.html">
        <div class="footer-icon">
          <img src="{% static 'images/home.svg' %}" alt="" />Главная
        </div>
      </a>
      <a href="create_post.html">
        <div class="footer-icon">
          <img src="{% static 'images/create.svg' %}" alt="" />Создать
        </div>
      </a>
      <a href="reg.html">
        <div class="footer-icon">
          <img src="{% static 'images/profile.svg' %}" alt="" />Войти
        </div>
      </a>
    </footer>

    <!-- ✅ JWT ПРОВЕРКА (добавлено в конец) -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('access_token');
      const username = localStorage.getItem('username');
      const authLinks = document.getElementById('auth-links');
      
      // ✅ Если JWT есть, но Django показывает "Войти" - меняем на "Профиль | Выйти"
      if (token && username && authLinks.innerHTML.includes('Войти')) {
        authLinks.innerHTML = `
          <a href="/users/profile/?user=${localStorage.getItem('user_id')}" class="header-link">Профиль</a>
          <a href="#" onclick="logout()" class="header-link">Выйти</a>
        `;
        console.log('✅ JWT авторизация обнаружена!');
      }
    });
    </script>
  </body>
</html>
